# 重新檢查和修正HTML內容，並更新版本號為 20250506-16，確保所有功能都能正常運作。
html_corrected = """
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成表格</title>
    <style id="custom-style">
        /* 版本：20250506-16 */
        @font-face {
            font-family: '文鼎中特標宋注音';
            src: url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff2?v=20250506-16') format('woff2'),
                 url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff?v=20250506-16') format('woff'),
                 url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/文鼎中特標宋注音.ttc?v=20250506-16') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: '文鼎中特標宋注音', sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%; max-width: 450px;
            background: #fff; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin: 0 0 5px;
            font-size: 24px; color: #333;
        }
        .version {
            text-align: right;
            font-size: 12px; color: #666;
            margin-bottom: 15px;
        }
        .input-group { margin-bottom: 10px; }
        .full-width { width: 100%; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #666; }
        input, textarea, select {
            width: 100%; padding: 8px; border: 1px solid #ddd;
            border-radius: 5px; font-size: 14px; box-sizing: border-box;
        }
        textarea { height: 100px; resize: vertical; }
        .info-display {
            display: flex; justify-content: space-between;
            margin: 15px 0; padding: 10px 0;
            font-size: 16px; color: #333;
            border-top: 1px solid #eee; border-bottom: 1px solid #eee;
        }
        .buttons-container { display: flex; justify-content: space-between; margin-top: 20px; }
        .buttons-container button {
            flex: 1; margin: 0 5px; padding: 10px;
            background: #333; color: #fff; border: none; border-radius: 5px;
            font-size: 14px; cursor: pointer;
        }
        .buttons-container button:hover { background: #45a049; }
        #description {
            display: none;
            position: fixed; top:50%; left:50%; transform: translate(-50%, -50%);
            background: #fff; padding:20px; max-width:80%; max-height:80%;
            overflow-y:auto; box-shadow:0 2px 10px rgba(0,0,0,0.2); border-radius:10px;
            z-index:1000;
        }
        #description h2 { margin-top:0; }
        #description button {
            margin-top:15px; padding:8px 12px;
            background:#333; color:#fff; border:none; border-radius:5px;
            cursor:pointer;
        }
        .print-area { display:grid; justify-content:center; align-content:center; }
        .cell {
            border:1px solid #000; display:flex; flex-direction:column;
            align-items:center; justify-content:flex-start;
            overflow:hidden; word-wrap:break-word; text-align:center;
        }
        .vertical-rl { writing-mode:vertical-rl; text-orientation:upright; }
        .horizontal-tb { writing-mode:horizontal-tb; }
    </style>
</head>
<body>
  <div class="container">
    <h1>生成表格</h1>
    <div class="version">版本：20250506-16</div>
    <div class="input-group full-width">
      <label>資料輸入</label>
      <textarea id="data-input" oninput="updateDataCount()"></textarea>
    </div>
    <div class="input-group">
      <label>水平欄位</label>
      <input type="number" id="columns" value="18" min="1" max="50" oninput="updatePageInfo()">
    </div>
    <div class="input-group">
      <label>垂直欄位</label>
      <input type="number" id="rows" value="4" min="1" max="50" oninput="updatePageInfo()">
    </div>
    <div class="input-group">
      <label>水平邊距 (mm)</label>
      <input type="number" id="margin-horizontal" value="10" min="0" max="50">
    </div>
    <div class="input-group">
      <label>垂直邊距 (mm)</label>
      <input type="number" id="margin-vertical" value="10" min="0" max="50">
    </div>
    <div class="input-group">
      <label>自訂字型</label>
      <input type="text" id="font-family" value="文鼎中特標宋注音">
    </div>
    <div class="input-group">
      <label>分隔符號</label>
      <input type="text" id="delimiter" placeholder="輸入分隔符號">
    </div>
    <div class="input-group">
      <label>排列方向</label>
      <select id="order">
        <option value="horizontal-rtl">水平右到左</option>
        <option value="horizontal-ltr">水平左到右</option>
        <option value="vertical-ltr">垂直左到右</option>
        <option value="vertical-rtl">垂直右到左</option>
      </select>
    </div>
    <div class="input-group">
      <label>書寫方式</label>
      <select id="writing-mode">
        <option value="vertical-rl">直書</option>
        <option value="horizontal-tb">橫書</option>
      </select>
    </div>
    <div class="input-group">
      <label>字體大小 (pt)</label>
      <input type="number" id="font-size" placeholder="選填">
    </div>
    <div class="info-display">
      <span>資料數量: <span id="data-count">0</span></span>
      <span>表格: <span id="page-info">1/1</span></span>
    </div>
    <div class="buttons-container">
      <button onclick="showDescription()">說明</button>
      <button onclick="generateTable()">產生</button>
      <button onclick="saveData()">保存</button>
      <button onclick="loadData()">讀取</button>
      <button onclick="prevPage()">上一頁</button>
      <button onclick="nextPage()">下一頁</button>
    </div>
  </div>

  <div id="description">
    <h2>功能說明</h2>
    <ul>
      <li>輸入姓名清單，選擇欄列、邊距與書寫方向後，點擊「產生」生成 A4 表格。</li>
      <li>可自訂字型（含注音）並預覽結果。</li>
      <li>每格上方 0.6cm 空白「日期」列，下方 3.5cm 姓名列。</li>
      <li>支持分頁瀏覽：使用「上一頁/下一頁」切換。</li>
      <li>「保存」可下載資料，「讀取」可載入文字檔。</li>
    </ul>
    <button onclick="hideDescription()">關閉說明</button>
  </div>

  <script>
    let currentPage = 0, totalPages = 1, dataCount = 0;

    function showDescription() {
      document.getElementById('description').style.display = 'block';
    }
    function hideDescription() {
      document.getElementById('description').style.display = 'none';
    }
    function updateDataCount() {
      const delim = document.getElementById('delimiter').value || '\n';
      const data = document.getElementById('data-input').value.split(delim);
      dataCount = data.filter(d => d.trim() !== '').length;
      document.getElementById('data-count').textContent = dataCount;
      updatePageInfo();
    }
    function updatePageInfo() {
      const cols = parseInt(document.getElementById('columns').value, 10);
      const rows = parseInt(document.getElementById('rows').value, 10);
      totalPages = Math.ceil(dataCount / (cols * rows)) || 1;
      currentPage = Math.min(currentPage, totalPages - 1);
      document.getElementById('page-info').textContent = (currentPage + 1) + '/' + totalPages;
    }
    function adjustFontSize(cell, customSize) {
      if (customSize) {
        cell.style.fontSize = customSize + 'pt'; return;
      }
      let size = 100;
      while (size >= 6) {
        cell.style.fontSize = size + 'pt';
        if (cell.scrollWidth <= cell.clientWidth && cell.scrollHeight <= cell.clientHeight) break;
        size--;
      }
    }
    function generateTable() {
      updateDataCount();
      const cols = parseInt(document.getElementById('columns').value, 10);
      const rows = parseInt(document.getElementById('rows').value, 10);
      const mh = parseFloat(document.getElementById('margin-horizontal').value);
      const mv = parseFloat(document.getElementById('margin-vertical').value);
      const ff = document.getElementById('font-family').value;
      const delim = document.getElementById('delimiter').value || '\n';
      const dataArr = document.getElementById('data-input').value.split(delim);
      const fs = document.getElementById('font-size').value;
      const order = document.getElementById('order').value;
      const mode = document.getElementById('writing-mode').value;
      const pw = 297, ph = 210;
      const cw = (pw - 2 * mh) / cols, ch = (ph - 2 * mv) / rows;
      let tableHTML = `<div class="print-area" style="grid-template-columns:repeat(${cols},${cw}mm);grid-template-rows:repeat(${rows},${ch}mm);margin:${mv}mm ${mh}mm;">`;
      const start = currentPage * cols * rows;
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const idx = start + i * cols + j;
          const txt = (dataArr[idx] || '').trim();
          tableHTML += `<div class="cell ${mode}" style="width:${cw}mm;height:${ch}mm;font-family:'${ff}',sans-serif;">
                           <div style="width:100%;height:6mm;border-bottom:1px solid #000;"></div>
                           <div style="width:100%;height:35mm;display:flex;align-items:center;justify-content:center;">${txt}</div>
                       </div>`;
        }
      }
      tableHTML += '</div>';
      const printStyle = document.getElementById('custom-style').outerHTML;
      const newWin = window.open('', '_blank', 'width=800,height=600');
      newWin.document.write(`<html><head><title>生成表格</title>${printStyle}</head><body>${tableHTML}</body></html>`);
      newWin.document.close();
      newWin.document.querySelectorAll('.cell').forEach(c => adjustFontSize(c, fs));
    }
    function saveData() {
      const data = document.getElementById('data-input').value;
      const d = new Date();
      const fname = `資料_${d.getFullYear()}${d.getMonth()+1}${d.getDate()}_${d.getHours()}${d.getMinutes()}${d.getSeconds()}.txt`;
      const blob = new Blob([data], { type: 'text/plain' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = fname; a.click();
    }
    function loadData() {
      const inp = document.createElement('input'); inp.type = 'file'; inp.accept = '.txt';
      inp.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => { document.getElementById('data-input').value = ev.target.result; updateDataCount(); };
        reader.readAsText(file);
      };
      inp.click();
    }
    function prevPage() { if (currentPage > 0) { currentPage--; generateTable(); } }
    function nextPage() { if (currentPage < totalPages - 1) { currentPage++; generateTable(); } }
  </script>
</body>
</html>
""" 

with open('/mnt/data/TableMaker_final_v16.html','w',encoding='utf-8') as f:
    f.write(html_corrected)

"/mnt/data/TableMaker_final_v16.html"
