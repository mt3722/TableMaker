<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>生成表格</title>
  <style id="custom-style">
    /* 版本：20250506-18 */
    @font-face {
      font-family: '文鼎中特標宋注音';
      src: url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff2?v=20250506-18') format('woff2'),
           url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff?v=20250506-18') format('woff'),
           url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/文鼎中特標宋注音.ttc?v=20250506-18') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: '文鼎中特標宋注音', sans-serif;
      margin: 0; padding: 10px;
      background: #f0f0f0;
      display: flex; justify-content: center;
      align-items: flex-start; min-height: 100vh;
    }
    .container {
      width: 100%; max-width: 450px;
      background: #fff; border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center; margin: 0 0 5px;
      font-size: 24px; color: #333;
    }
    .version {
      text-align: right; font-size: 12px; color: #666;
      margin-bottom: 15px;
    }
    .input-group { margin-bottom: 10px; }
    .full-width { width: 100%; }
    label {
      display: block; margin-bottom: 5px;
      font-weight: bold; color: #666;
    }
    input, textarea, select {
      width: 100%; padding: 8px;
      border: 1px solid #ddd; border-radius: 5px;
      font-size: 14px; box-sizing: border-box;
    }
    textarea { height: 100px; resize: vertical; }
    .info-display {
      display: flex; justify-content: space-between;
      margin: 15px 0; padding: 10px 0;
      font-size: 16px; color: #333;
      border-top: 1px solid #eee; border-bottom: 1px solid #eee;
    }
    .buttons-container {
      display: flex; justify-content: space-between;
      margin-top: 20px;
    }
    .buttons-container button {
      flex: 1; margin: 0 5px; padding: 10px;
      background: #333; color: #fff; border: none;
      border-radius: 5px; font-size: 14px;
      cursor: pointer;
    }
    .buttons-container button:hover {
      background: #45a049;
    }
    .print-area {
      display: grid;
      justify-content: center;
      align-content: center;
    }
    .cell {
      border: 1px solid black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow: hidden;
      word-wrap: break-word;
      text-align: center;
    }
    .vertical-rl { writing-mode: vertical-rl; text-orientation: upright; }
    .horizontal-tb { writing-mode: horizontal-tb; }
  </style>
</head>
<body>
  <div class="container">
    <h1>生成表格</h1>
    <div class="version">版本：20250506-18</div>
    <div class="input-group full-width">
      <label for="data-input">資料輸入</label>
      <textarea id="data-input" oninput="updateDataCount()"></textarea>
    </div>
    <div class="input-group">
      <label for="columns">水平欄位</label>
      <input type="number" id="columns" value="18" min="1" max="50" oninput="updatePageInfo()">
    </div>
    <div class="input-group">
      <label for="rows">垂直欄位</label>
      <input type="number" id="rows" value="4" min="1" max="50" oninput="updatePageInfo()">
    </div>
    <div class="input-group">
      <label for="font-size">字體大小 (pt)</label>
      <input type="number" id="font-size" placeholder="選填">
    </div>
    <div class="info-display">
      <span>資料數量: <span id="data-count">0</span></span>
      <span>表格: <span id="page-info">1/1</span></span>
    </div>
    <div class="buttons-container">
      <button onclick="generateTable()">產生</button>
    </div>
  </div>

  <script>
    let currentPage = 0, totalPages = 1, dataCount = 0;

    function updateDataCount() {
      const input = document.getElementById('data-input').value.trim();
      const arr = input.split('\n').filter(line => line.trim() !== '');
      dataCount = arr.length;
      document.getElementById('data-count').textContent = dataCount;
      updatePageInfo();
    }

    function updatePageInfo() {
      const cols = parseInt(document.getElementById('columns').value, 10);
      const rows = parseInt(document.getElementById('rows').value, 10);
      totalPages = Math.ceil(dataCount / (cols * rows)) || 1;
      currentPage = Math.min(currentPage, totalPages - 1);
      document.getElementById('page-info').textContent = `${currentPage + 1}/${totalPages}`;
    }

    function adjustFontSize(cell, customSize) {
      if (customSize) {
        cell.style.fontSize = customSize + 'pt';
        return;
      }
      let size = 100;
      while (size >= 6) {
        cell.style.fontSize = size + 'pt';
        if (cell.scrollWidth <= cell.clientWidth && cell.scrollHeight <= cell.clientHeight) break;
        size--;
      }
    }

    function generateTable() {
      updateDataCount();
      const cols = parseInt(document.getElementById('columns').value, 10);
      const rows = parseInt(document.getElementById('rows').value, 10);
      const data = document.getElementById('data-input').value.trim().split('\n').filter(line => line.trim() !== '');
      const fontSize = document.getElementById('font-size').value;
      const cellWidth = (297 - 20) / cols;
      const cellHeight = (210 - 20) / rows;
      let tableHTML = `<div class="print-area" style="grid-template-columns: repeat(${cols}, ${cellWidth}mm); grid-template-rows: repeat(${rows}, ${cellHeight}mm); margin: 10mm;">`;
      const startIndex = currentPage * cols * rows;
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const index = startIndex + i * cols + j;
          const content = data[index] || '';
          tableHTML += `<div class="cell vertical-rl" style="width: ${cellWidth}mm; height: ${cellHeight}mm;">
            <div style="width:100%; height:6mm; border-bottom:1px solid #000;"></div>
            <div style="width:100%; height:35mm; display:flex; align-items:center; justify-content:center;">${content}</div>
          </div>`;
        }
      }
      tableHTML += '</div>';
      const newWindow = window.open('', '', 'width=800,height=600');
      newWindow.document.write('<html><head><title>生成表格</title>');
      newWindow.document.write(document.getElementById('custom-style').outerHTML);
      newWindow.document.write('</head><body>' + tableHTML + '</body></html>');
      newWindow.document.close();
      const cells = newWindow.document.querySelectorAll('.cell');
      cells.forEach(cell => adjustFontSize(cell, fontSize));
    }
  </script>
</body>
</html>
