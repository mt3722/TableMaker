<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成表格</title>
    <style id="custom-style">
        /* 版本：20250506-12 */
        @font-face {
            font-family: '文鼎中特標宋注音';
            src: url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff2?v=20250506-10') format('woff2'),
                 url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/StdMingZuinnEG-Eb.woff?v=20250506-10') format('woff'),
                 url('https://cdn.jsdelivr.net/gh/mt3722/TableMaker/文鼎中特標宋注音.ttc?v=20250506-10') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: '文鼎中特標宋注音', sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 450px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin: 0 0 5px 0;
            font-size: 24px;
        }
        .version {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }
        .input-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .input-group {
            width: 48%;
        }
        .full-width {
            width: 100%;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: bold;
            font-size: 14px;
        }
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .info-display {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            color: #333;
            margin: 15px 0;
            padding: 10px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        .buttons-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 10px 5px;
            border: none;
            border-radius: 5px;
            background-color: #333333;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap;
            margin: 0 5px;
        }
        button:first-child {
            margin-left: 0;
        }
        button:last-child {
            margin-right: 0;
        }
        button:hover {
            background-color: #45a049;
        }
        .print-area {
            display: grid;
            justify-content: center;
            align-content: center;
        }
        .cell {
            border: 1px solid black;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
            word-wrap: break-word;
            text-align: center;
        }
        .vertical-rl {
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        .horizontal-tb {
            writing-mode: horizontal-tb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>生成表格</h1>
        <div class="version">版本：20250506-12</div>
        <div class="input-group full-width">
            <label for="data-input">資料輸入</label>
            <textarea id="data-input" oninput="updateDataCount()"></textarea>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="columns">水平欄位</label>
                <input type="number" id="columns" value="18" min="1" max="50" oninput="updatePageInfo()">
            </div>
            <div class="input-group">
                <label for="rows">垂直欄位</label>
                <input type="number" id="rows" value="4" min="1" max="50" oninput="updatePageInfo()">
            </div>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="margin-horizontal">水平邊距</label>
                <input type="number" id="margin-horizontal" value="10" min="0" max="50">
            </div>
            <div class="input-group">
                <label for="margin-vertical">垂直邊距</label>
                <input type="number" id="margin-vertical" value="10" min="0" max="50">
            </div>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="font-family">自訂字型</label>
                <input type="text" id="font-family" value="文鼎中特標宋注音">
            </div>
            <div class="input-group">
                <label for="delimiter">分隔符號</label>
                <input type="text" id="delimiter" placeholder="輸入分隔符號">
            </div>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="order">排列方向</label>
                <select id="order">
                    <option value="horizontal-rtl">水平右到左</option>
                    <option value="horizontal-ltr">水平左到右</option>
                    <option value="vertical-ltr">垂直左到右</option>
                    <option value="vertical-rtl">垂直右到左</option>
                </select>
            </div>
            <div class="input-group">
                <label for="writing-mode">書寫方式</label>
                <select id="writing-mode">
                    <option value="vertical-rl">直書</option>
                    <option value="horizontal-tb">橫書</option>
                </select>
            </div>
        </div>
        <div class="input-group full-width">
            <label for="font-size">字體大小</label>
            <input type="number" id="font-size" placeholder="輸入字體大小 (選填)">
        </div>
        <div class="info-display">
            <span>資料數量: <span id="data-count">0</span></span>
            <span>表格: <span id="page-info">1/1</span></span>
        </div>
        <div class="buttons-container">
            <button onclick="showDescription()">說明</button>
            <button onclick="saveData()">保存</button>
            <button onclick="document.getElementById('file-input').click()">讀取</button>
            <button onclick="prevPage()">上一頁</button>
            <button onclick="nextPage()">下一頁</button>            <button onclick="generateTable()">產生</button>
        </div>
        <input type="file" id="file-input" style="display:none" onchange="loadData(event)">
    </div>

    <div id="description">
        <h2>功能說明</h2>
        <ul>
            <li>功能是簡易地創造出可輸入名單的表格，並且可以自訂字型。</li>
            <li><strong>欄位：</strong>控制欄位數量。</li>
            <li><strong>邊距：</strong>控制表格與紙張邊界距離。</li>
            <li><strong>字型：</strong>設定生成表格的字型。</li>
            <li><strong>分隔：</strong>設定資料分隔符號。</li>
            <li><strong>排列：</strong>選擇表格排列方式。</li>
            <li><strong>書寫：</strong>選擇表格書寫方向。</li>
            <li><strong>字體大小：</strong>自訂字體大小。</li>
            <li><strong>資料：</strong>即時顯示資料的數量。</li>
            <li><strong>表格：</strong>即時顯示目前表格和總表格數。</li>
            <li><strong>上一頁/下一頁：</strong>瀏覽不同頁面的表格。</li>
            <li><strong>保存：</strong>將資料保存到檔案。</li>
            <li><strong>讀取：</strong>從檔案載入資料。</li>
            <li><strong>產生：</strong>生成表格並顯示。</li>
        </ul>
        <button id="close-description" onclick="hideDescription()">關閉</button>
    </div>

    <script>
        let currentPage = 0;
        let totalPages = 1;
        let dataCount = 0;

        function showDescription() {
            document.getElementById('description').style.display = 'block';
        }

        function hideDescription() {
            document.getElementById('description').style.display = 'none';
        }

        function updateDataCount() {
            const delim = document.getElementById('delimiter').value;
            const data = document.getElementById('data-input').value.split(delim || '\n');
            dataCount = data.length;
            document.getElementById('data-count').textContent = dataCount;
            updatePageInfo();
        }

        function updatePageInfo() {
            const cols = parseInt(document.getElementById('columns').value, 10);
            const rows = parseInt(document.getElementById('rows').value, 10);
            totalPages = Math.ceil(dataCount / (cols * rows)) || 1;
            currentPage = Math.min(currentPage, totalPages - 1);
            document.getElementById('page-info').textContent = `${currentPage+1}/${totalPages}`;
        }

        function adjustFontSize(cell, customSize) {
            if (customSize) {
                cell.style.fontSize = customSize + 'pt';
                return;
            }
            let size = 100, min=6;
            while (size>=min) {
                cell.style.fontSize = size+'pt';
                if(cell.scrollWidth<=cell.clientWidth && cell.scrollHeight<=cell.clientHeight) break;
                size--;
            }
        }

        function generateTable() {
            const cols = parseInt(document.getElementById('columns').value,10);
            const rows = parseInt(document.getElementById('rows').value,10);
            const mh = parseFloat(document.getElementById('margin-horizontal').value);
            const mv = parseFloat(document.getElementById('margin-vertical').value);
            const ff = document.getElementById('font-family').value;
            const delim = document.getElementById('delimiter').value;
            const data = document.getElementById('data-input').value.split(delim || '\n');
            const fs = document.getElementById('font-size').value;
            const order = document.getElementById('order').value;
            const mode = document.getElementById('writing-mode').value;
            const pw=297, ph=210;
            const cw=(pw-2*mh)/cols, ch=(ph-2*mv)/rows;
            const total=cols*rows;
            let html=`<div class="print-area" style="grid-template-columns:repeat(${cols},${cw}mm);grid-template-rows:repeat(${rows},${ch}mm);margin:${mv}mm ${mh}mm;">`;
            let idx0=currentPage*total;
            for(let i=0;i<rows;i++){
                for(let j=0;j<cols;j++){
                    let idx;
                    switch(order){
                        case 'horizontal-ltr': idx=idx0+i*cols+(cols-1-j);break;
                        case 'vertical-ltr': idx=idx0+j*rows+i;break;
                        case 'vertical-rtl': idx=idx0+(cols-1-j)*rows+i;break;
                        default: idx=idx0+i*cols+j;
                    }
                    const text=data[idx]||'';
                    html+=`<div class="cell ${mode}" style="width:${cw}mm;height:${ch}mm;font-family:'${ff}',sans-serif;">
                        <div style="width:100%;height:6mm;border-bottom:1px solid #000;"></div>
                        <div style="width:100%;height:35mm;display:flex;align-items:center;justify-content:center;">${text}</div>
                    </div>`;
                }
            }
            html+='</div>';
            const printStyle = document.getElementById('custom-style').outerHTML;
            const pageStyle = `<style>@page { size: A4 ${orientation}; }</style>`;
            const win=window.open('','_blank','width=800,height=600');
            win.document.write(`<html><head><title>生成表格</title>${printStyle}${pageStyle}</head><body>`${html}</body></html>`);
            win.document.close();
            win.document.querySelectorAll('.cell').forEach(c=>adjustFontSize(c,fs));
        }
    </script>
</body>
</html>
